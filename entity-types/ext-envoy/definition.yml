domain: EXT
type: ENVOY
synthesis:
  rules:
    - identifier: host.hostname
      name: host.hostname
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: envoy_
    # prometheus
    - compositeIdentifier:
      separator: ":"
      attributes:
        - cluster_name
        - pod
      encodeIdentifierInGUID: true
      name: pod
      conditions:
        - attribute: metricName
          prefix: envoy_
    # otel
    - compositeIdentifier:
      separator: ":"
      attributes:
        - k8s.cluster.name
        - k8s.pod.name
      encodeIdentifierInGUID: true
      name: pod
      conditions:
        - attribute: metricName
          prefix: envoy_

  tags:
    # prometheus
    cluster_name:
      entityTagName: k8s.clusterName
      ttl: P1D
    namespace:
      entityTagName: k8s.namespaceName
      ttl: P1D
    node:
      entityTagName: k8s.nodeName
      ttl: P1D
    pod:
      entityTagName: k8s.podName
      ttl: P1D

    # otel
    k8s.cluster.name:
      entityTagName: k8s.clusterName
      ttl: P1D
    k8s.namespace.name:
      entityTagName: k8s.namespaceName
      ttl: P1D
    k8s.node.name:
      entityTagName: k8s.nodeName
      ttl: P1D
    k8s.pod.name:
      entityTagName: k8s.podName
      ttl: P1D

dashboardTemplates:
  newrelic:
    template: dashboard.json
configuration:
  entityExpirationTime: EIGHT_DAYS
  alertable: true
