domain: EXT
type: ARGOCD
synthesis:
  rules:
    # nri-prometheus
    - identifier: "label.app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "label.app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: argocd_app_

    - identifier: "label.app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "label.app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: argocd_cluster_

    - identifier: "label.app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "label.app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: argocd_git_

    - identifier: "label.app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "label.app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: argocd_kubectl_

    - identifier: "label.app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "label.app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: argocd_redis_

    - identifier: "label.app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "label.app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: grpc_server_

    # prometheus
    - identifier: "app_kubernetes_io_name"
      encodeIdentifierInGUID: true
      name: "app_kubernetes_io_name"
      conditions:
        - attribute: metricName
          prefix: "argocd_"

    # open telemetry rules
    - identifier: "app.kubernetes.io/name"
      encodeIdentifierInGUID: true
      name: "app.kubernetes.io/name"
      conditions:
        - attribute: metricName
          prefix: argocd_

  tags:
    # open telemetry attributes
    k8s.pod.name:
      entityTagName: k8s.podName
    k8s.cluster.name:
      entityTagName: k8s.clusterName
    k8s.namespace.name:
      entityTagName: k8s.namespaceName
    # prometheus attributes
    pod:
      entityTagName: k8s.podName
    cluster_name:
      entityTagName: k8s.clusterName
    namespace:
      entityTagName: k8s.namespaceName

goldenTags:
  - clusterName
  - namespaceName
  - deploymentName

dashboardTemplates:
  newRelic:
    template: dashboard.json

configuration:
  entityExpirationTime: FOUR_HOURS
  alertable: true
