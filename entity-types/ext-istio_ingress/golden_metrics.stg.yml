requestRate:
  title: Request rate
  unit: REQUESTS_PER_SECOND
  query:
    select: rate(sum(istio_requests_total), 1 MINUTE)
    from: Metric
    where: source_app = 'istio-proxy' AND destination_service_name != 'unknown' AND reporter = 'destination'
    facet: destination_service_name, destination_service_namespace

responseTime:
  title: Response time
  unit: MS
  query:
    select: percentile(istio_request_duration_milliseconds, 95)
    where: source_app = 'istio-proxy' AND destination_service_name != 'unknown' AND reporter = 'destination'
    from: Metric
    facet: destination_service_name, destination_service_namespace

upstreamResponseTime:
  title: Upstream response time
  unit: MS
  query:
    select: percentile(istio_request_duration_milliseconds, 95)
    where: source_app != 'unknown' AND destination_service_name != 'unknown' AND reporter = 'source'
    from: Metric
    facet: destination_service_name, source_app

errorRate:
  title: Error rate
  unit: PERCENTAGE
  query:
    select: filter(count(istio_requests_total), WHERE response_code LIKE '5%') / count(istio_requests_total) * 100
    from: Metric
    where: source_app = 'istio-proxy' AND destination_service_name != 'unknown' AND reporter = 'destination'
    facet: destination_service_name, destination_service_namespace
